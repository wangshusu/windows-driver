# 一.学习记录

[《Windows内核分析》专题-索引目录 - OneTrainee - 博客园 (cnblogs.com)](https://www.cnblogs.com/onetrainee/p/11675224.html)







## 1.驱动搭建开发环境

1.1 开启windows的测试模式

![image-20230625212901153](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252129640.png)

```C++
bcdedit /set testsigning ON
```

cmd huozhe shell命令输入后 系统的右下角出现 测试模式 代表成功

![image-20230625213031233](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252130821.png)





## 2.hellworld驱动与安装

2.1最简单的helloworld驱动

![image-20230625213620959](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252136143.png)

```C++
VOID  DriverUnload()

```





## 3.操作系统与指针

![image-20230625213824678](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252138645.png)



## 4.驱动对象与设备对象

驱动对象

<img src="https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252141263.png" alt="image-20230625214127744"  />

```C++


```





设备对象

![image-20230625215301074](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356200.png)

```C++


```



![image-20230625215728865](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356031.png)

![image-20230625220649966](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356656.png)

![image-20230625220514433](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356450.png)

![image-20230625215705074](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356113.png)

![image-20230625220210482](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356819.png)

![image-20230625220423879](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356609.png)

![image-20230625220619046](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356357.png)



驱动开发之符号链接和设备名称

![image-20230625220734970](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356471.png)

![image-20230625220822025](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356209.png)



查看驱动设备对象

![image-20230625220913098](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356485.png)





## 5.驱动框架类型分类

NT驱动

WDM驱动（inf文件安装）

![image-20230625221329531](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356372.png)

![image-20230625221303849](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356087.png)



WDF驱动





5.2 去掉数字强制签名x64



## 6.内存管理与new封装

6.1 分页内存和非分页内存

内核中的内存申请函数

ExAlloctrePool

![image-20230627232042727](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306272320785.png)



![image-20230625222921701](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356999.png)



![image-20230625223041386](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356987.png)

RtlZeroMemory(清空)

![image-20230625223253707](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356432.png)

ExFreePool（释放内存）

![image-20230625223514186](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356924.png)



6.3 内核中使用C++重载 new delete 操作 重载操作符[]

![image-20230625223943866](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252356084.png)

需实现new的封装



## 7. 驱动中字符串的处理与数据类型

不做深拷贝只复制指针

![image-20230627232612217](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306272326333.png)



![image-20230627233049106](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306272330256.png)



![image-20230627233252555](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306272332654.png)



类型

![image-20230627233513462](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306272335633.png)



![image-20230627233522578](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306272335668.png)



打印

![image-20230627233647835](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306272336034.png)



![image-20230627233723435](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306272337572.png)



![image-20230627233732467](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306272337611.png)



![image-20230627233744354](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306272337529.png)













## 8.

![image-20230627233934811](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306272339258.png)



![image-20230627233950144](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306272339467.png)



![image-20230627234023319](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306272340709.png)



![image-20230627234333793](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306272343000.png)



![image-20230627234445672](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306272344893.png)



![image-20230627234807948](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306272348194.png)



遍历 驱动  水平结构 垂直结构





## 9.IRQ中断与IRP包结构

中断有几个级别 , 高级中断不能操作内存, 低级终端操作读写



IRP包的结构

![image-20230628233943339](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306282339485.png)



![image-20230628234100872](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306282341015.png)



![image-20230628234451055]()





# 二.问题

## 1.helloworld编程问题

1.关闭解释器

![image-20230625235320832](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252353087.png)

2.生成与目标平台不相符的sys驱动文件直接蓝屏

![image-20230625235430777](https://bucketforago.oss-cn-shenzhen.aliyuncs.com/typora/202306252354688.png)



## 2.设备driver未知的符号和错误









